<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pressure Altitude Calculator (visueel)</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    body{margin:18px;color:#111;background:#f7f7f8}
    h1{font-size:20px;margin:0 0 10px}
    .card{background:white;border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(20,20,30,0.06);max-width:1000px}
    .row{display:flex;gap:12px;align-items:center}
    label{font-size:13px;min-width:120px}
    input[type=number],select{padding:7px;border-radius:6px;border:1px solid #ddd;font-size:14px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    .vis{display:flex;gap:18px;margin-top:12px}
    .svg-wrap{background:linear-gradient(#e9f0ff, #fff);padding:12px;border-radius:8px;flex:1}
    .info{flex:1;min-width:260px}
    .metric{font-size:28px;margin:8px 0}
    .small{font-size:13px;color:#555}
    button{background:#2b9d3b;color:white;padding:9px 12px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
    .note{font-size:12px;color:#666;margin-top:8px}
    /* scale */
    svg{width:160px;height:520px;display:block}
    .scale-line{stroke:#d0d7e6;stroke-width:1}
    .tick{stroke:#9aa6bf;stroke-width:1}
    .elev-marker{fill:#1f77b4}
    .pa-marker{fill:#ff7f0e}
  </style>
</head>
<body>
  <div class="card">
    <h1>Pressure altitude calculator — visueel</h1>
    <p class="small">Vul de hoogte (elevation) en de actuele QNH (hPa). De standaard referentie is 1013 hPa. De tool laat het verschil zien en berekent de pressure altitude.</p>

    <div class="controls">
      <div class="row">
        <label for="elev">Elevation (grondhoogte)</label>
        <input id="elev" type="number" value="150" step="1" min="-500" aria-label="elevation">
        <select id="elevUnit" aria-label="elevation unit">
          <option value="ft">ft</option>
          <option value="m">m</option>
        </select>
      </div>

      <div class="row">
        <label for="qnh">Actuele QNH (hPa)</label>
        <input id="qnh" type="number" value="1005" step="0.1" min="800" max="1100">
      </div>

      <div class="row">
        <label for="scale">Schaal (max hoogte)</label>
        <select id="scale">
          <option value="2000">2000 ft</option>
          <option value="5000">5000 ft</option>
          <option value="10000">10000 ft</option>
        </select>
      </div>

      <div class="row">
        <label></label>
        <button id="copyBtn">Kopieer resultaat</button>
      </div>
    </div>

    <div class="vis">
      <div class="svg-wrap">
        <svg id="visSvg" viewBox="0 0 160 520" preserveAspectRatio="xMidYMid meet">
          <!-- ground plane -->
          <rect x="0" y="370" width="160" height="150" fill="#dfe7f6"></rect>
          <rect x="0" y="460" width="160" height="60" fill="#b8c9ef"></rect>
          <text x="12" y="495" font-size="11" fill="#2b3b66">grondvlak</text>

          <!-- scale lines (generated by JS) -->
          <g id="scaleLines"></g>

          <!-- markers -->
          <g id="markers"></g>

        </svg>
      </div>

      <div class="info">
        <div class="small">Inputs</div>
        <div>elevation: <span id="outElev">150 ft</span></div>
        <div>qnh: <span id="outQnh">1005 hPa</span></div>
        <div class="small" style="margin-top:10px">Resultaten</div>
        <div>verschil QNH t.o.v. 1013: <span id="deltaHpa">8.0 hPa</span></div>
        <div class="metric">pressure altitude: <span id="paVal">374 ft</span></div>
        <div class="note">Berekening: pressure altitude = elevation + (1013 - QNH) × 27 ft per hPa (standaardbenadering). Als je meters gebruikt, wordt de conversie automatisch toegepast.</div>
      </div>
    </div>
  </div>

  <script>
    // Helper conversions
    function mToFt(m){return m*3.2808398950131}
    function ftToM(ft){return ft/3.2808398950131}

    const elevIn = document.getElementById('elev')
    const elevUnit = document.getElementById('elevUnit')
    const qnhIn = document.getElementById('qnh')
    const scaleSel = document.getElementById('scale')
    const outElev = document.getElementById('outElev')
    const outQnh = document.getElementById('outQnh')
    const deltaHpaEl = document.getElementById('deltaHpa')
    const paValEl = document.getElementById('paVal')

    const svg = document.getElementById('visSvg')
    const scaleGroup = document.getElementById('scaleLines')
    const markers = document.getElementById('markers')

    const copyBtn = document.getElementById('copyBtn')

    function calc(){
      let elevRaw = Number(elevIn.value)||0
      const unit = elevUnit.value
      let elevFt = unit==='m' ? mToFt(elevRaw) : elevRaw
      const qnh = Number(qnhIn.value)||1013
      const delta = 1013 - qnh // hPa
      // use 27 ft per hPa (approx. 8.23 m per hPa)
      const pa = Math.round(elevFt + delta * 27)

      // update text outputs
      outElev.textContent = (unit==='m') ? `${elevRaw} m (${Math.round(elevFt)} ft)` : `${Math.round(elevFt)} ft (${(Math.round(ftToM(elevFt)*10)/10)} m)`
      outQnh.textContent = `${qnh} hPa`
      deltaHpaEl.textContent = `${Math.abs(delta).toFixed(1)} hPa ${delta>0? 'lager dan' : delta<0? 'hoger dan' : 'gelijk aan'} 1013`
      paValEl.textContent = `${pa} ft (${Math.round(ftToM(pa))} m)`

      drawScaleAndMarkers(elevFt, pa)
    }

    function drawScaleAndMarkers(elevFt, paFt){
      // The svg viewBox height is 520. We'll map 0..maxScale ft to y positions inside 20..380 (above ground plane)
      const maxScale = Number(scaleSel.value)
      const topY = 20
      const bottomY = 370 // top of ground plane
      const usable = bottomY - topY

      // clear existing
      scaleGroup.innerHTML = ''
      markers.innerHTML = ''

      // draw horizontal ticks every 500 ft (or computed)
      const step = 500
      for(let h=0; h<=maxScale; h+=step){
        const frac = h / maxScale
        const y = topY + frac * usable
        const g = document.createElementNS('http://www.w3.org/2000/svg','g')
        const line = document.createElementNS('http://www.w3.org/2000/svg','line')
        line.setAttribute('x1',10)
        line.setAttribute('x2',150)
        line.setAttribute('y1',y)
        line.setAttribute('y2',y)
        line.setAttribute('class','scale-line')
        g.appendChild(line)
        const t = document.createElementNS('http://www.w3.org/2000/svg','text')
        t.setAttribute('x',118)
        t.setAttribute('y',y-4)
        t.setAttribute('font-size',10)
        t.setAttribute('fill','#223')
        t.textContent = `${maxScale - h} ft``
        // we want labels from top (max) down to 0 at ground
        scaleGroup.appendChild(g)
        scaleGroup.appendChild(t)
      }

      // convert a ft value to svg y (0 ft -> bottomY ; maxScale -> topY)
      function yFor(ft){
        // clamp
        const clamped = Math.max(0, Math.min(ft, maxScale))
        const frac = 1 - (clamped / maxScale) // because 0 -> bottom
        return topY + frac * usable
      }

      // elevation marker
      const elevY = yFor(elevFt)
      const elevRect = document.createElementNS('http://www.w3.org/2000/svg','rect')
      elevRect.setAttribute('x',40)
      elevRect.setAttribute('y',Math.min(elevY, bottomY-6))
      elevRect.setAttribute('width',80)
      elevRect.setAttribute('height',6)
      elevRect.setAttribute('class','elev-marker')
      markers.appendChild(elevRect)
      const elevText = document.createElementNS('http://www.w3.org/2000/svg','text')
      elevText.setAttribute('x',6)
      elevText.setAttribute('y',Math.min(elevY, bottomY-6)-6)
      elevText.setAttribute('font-size',11)
      elevText.textContent = `elevation ${Math.round(elevFt)} ft`
      markers.appendChild(elevText)

      // pressure altitude marker
      const paY = yFor(paFt)
      const paRect = document.createElementNS('http://www.w3.org/2000/svg','rect')
      paRect.setAttribute('x',20)
      paRect.setAttribute('y',Math.min(paY, bottomY-6))
      paRect.setAttribute('width',120)
      paRect.setAttribute('height',4)
      paRect.setAttribute('class','pa-marker')
      markers.appendChild(paRect)
      const paText = document.createElementNS('http://www.w3.org/2000/svg','text')
      paText.setAttribute('x',6)
      paText.setAttribute('y',Math.min(paY, bottomY-6)-12)
      paText.setAttribute('font-size',11)
      paText.textContent = `pressure alt ${Math.round(paFt)} ft`
      markers.appendChild(paText)

      // if pa is above scale, show arrow and label
      if(paFt > maxScale){
        const arrow = document.createElementNS('http://www.w3.org/2000/svg','text')
        arrow.setAttribute('x',6)
        arrow.setAttribute('y',14)
        arrow.setAttribute('font-size',12)
        arrow.textContent = `▲ ${Math.round(paFt)} ft (boven schaal)`
        markers.appendChild(arrow)
      }

    }

    // copy results
    copyBtn.addEventListener('click', ()=>{
      const txt = `Elevation: ${elevIn.value} ${elevUnit.value}\nQNH: ${qnhIn.value} hPa\nPressure altitude: ${paValEl.textContent}`
      navigator.clipboard.writeText(txt).then(()=>{
        copyBtn.textContent = 'Gekopieerd!'
        setTimeout(()=>copyBtn.textContent='Kopieer resultaat',1400)
      })
    })

    // wire events
    [elevIn,elevUnit,qnhIn,scaleSel].forEach(el=>el.addEventListener('input', calc))

    // initial draw
    calc()
  </script>
</body>
</html>
