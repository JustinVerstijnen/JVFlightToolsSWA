<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Course Calculator - justinverstijnen.nl</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;
      background: #e5e7eb;
      box-sizing: border-box;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }
    body {
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
      background: #e5e7eb;
    }
    .app {
      max-width: 1200px;
      width: 100%;
      background: #f9fafb;
      border-radius: 1.25rem;
      padding: 2rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.15);
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .app-row {
      display: flex;
      gap: 2rem;
      width: 100%;
    }
    .card-equal {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    h1 {
      margin: 0 0 0.25rem;
      font-size: 1.7rem;
    }
    .subtitle {
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
      color: #6b7280;
    }

    .card {
      background: #ffffff;
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .card h2 {
      margin: 0 0 0.7rem;
      font-size: 1rem;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0.35rem 0;
      flex-wrap: wrap;
    }
    .row label {
      min-width: 175px;
      font-size: 0.85rem;
      color: #374151;
    }

    .row small {
      font-size: 0.7rem;
      color: #9ca3af;
      display: block;
    }

    input[type="range"] {
      flex: 1 1 160px;
      max-width: 260px;
    }
    input[type="number"] {
      width: 70px;
      padding: 0.2rem 0.35rem;
      border-radius: 0.4rem;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 0.85rem;
      color: #111827;
    }

    select {
      padding: 0.35rem 0.6rem;
      font-size: 0.9rem;
      border-radius: 0.5rem;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
    }

    .grid-three {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.75rem 1.5rem;
      margin-top: 0.6rem;
    }
    .group-title {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 0.8rem;
      text-transform: uppercase;
    }
    .value-label { font-size: 0.8rem; color: #6b7280; }
    .value-number { font-size: 0.95rem; font-variant-numeric: tabular-nums; }

    .note {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.6rem;
    }

    canvas {
      width: 100%;
      max-width: 640px;
      background: #ffffff;
      border-radius: 1rem;
      border: 1px solid #e5e7eb;
      display: block;
      margin: 0 auto;
    }

    @media (max-width: 960px) {
      .app-row { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Course calculator</h1>
      <div class="subtitle">With this tool you can calculate your planned course and track and compensate it for wind, drift and such.</div>
    </header>

    <div class="app-row">
      <!-- Basis-invoer -->
      <section class="card card-equal">
        <h2>1. Input</h2>

        <div class="row">
          <label>Input</label>
          <select id="modeSelect">
            <option value="TT">True Track (TT)</option>
            <option value="TH">True Heading (TH)</option>
            <option value="TC">True Course (TC)</option>
            <option value="CH">Compass Heading (CH)</option>
          </select>
        </div>

        <div class="row">
          <label>True Course (TC)<small>0–359°</small></label>
          <input id="tcRange" type="range" min="0" max="359">
          <input id="tcInput" type="number" min="0" max="359">
        </div>

        <div class="row">
          <label>True Heading (TH)<small>0–359°</small></label>
          <input id="thRange" type="range" min="0" max="359">
          <input id="thInput" type="number" min="0" max="359">
        </div>

        <div class="row">
          <label>True Track (TT)<small>0–359°</small></label>
          <input id="ttRange" type="range" min="0" max="359">
          <input id="ttInput" type="number" min="0" max="359">
        </div>

        <div class="row">
          <label>Compass Heading (CH)<small>0–359°</small></label>
          <input id="chRange" type="range" min="0" max="359">
          <input id="chInput" type="number" min="0" max="359">
        </div>

        <div class="row">
          <label>Variation (VAR)<small>E +, W −</small></label>
          <input id="variationRange" type="range" min="-30" max="30">
          <input id="variationInput" type="number" min="-30" max="30">
        </div>

        <div class="row">
          <label>Deviation (DEV)<small>E +, W −</small></label>
          <input id="deviationRange" type="range" min="-10" max="10">
          <input id="deviationInput" type="number" min="-10" max="10">
        </div>

        <div class="row">
          <label>Wind Correction (WCA)<small>R +, L −</small></label>
          <input id="wcaRange" type="range" min="-30" max="30">
          <input id="wcaInput" type="number" min="-30" max="30">
        </div>

        <div class="row">
          <label>Drift (DA)<small>Drift = −WCA</small></label>
          <input id="driftDisplay" type="number" disabled>
        </div>
      </section>

      <!-- Resultaten -->
      <section class="card card-equal">
        <h2>2. Results</h2>

        <div class="group-title">Course</div>
        <div class="grid-three">
          <div><div class="value-label">True Course (TC)</div><div class="value-number" id="tcOut"></div></div>
          <div><div class="value-label">Magnetic Course (MC)</div><div class="value-number" id="mcOut"></div></div>
          <div><div class="value-label">Compas Course (CC)</div><div class="value-number" id="ccOut"></div></div>
        </div>

        <div class="group-title">Heading</div>
        <div class="grid-three">
          <div><div class="value-label">True Heading (TH)</div><div class="value-number" id="thOut"></div></div>
          <div><div class="value-label">Magnetic Heading (MH)</div><div class="value-number" id="mhOut"></div></div>
          <div><div class="value-label">Compass Heading (CH)</div><div class="value-number" id="chOut"></div></div>
        </div>

        <div class="group-title">Track</div>
        <div class="grid-three">
          <div><div class="value-label">True Track (TT)</div><div class="value-number" id="ttOut"></div></div>
          <div><div class="value-label">Magnetic Track (MT)</div><div class="value-number" id="mtOut"></div></div>
          <div><div class="value-label">Compass Track (CT)</div><div class="value-number" id="ctOut"></div></div>
        </div>

        <div class="group-title">Variables</div>
        <div class="grid-three">
          <div><div class="value-label">Variation (VAR)</div><div class="value-number" id="varOut"></div></div>
          <div><div class="value-label">Deviation (DEV)</div><div class="value-number" id="devOut"></div></div>
          <div><div class="value-label">Wind Correction Angle/Drift (WCA/DA)</div><div class="value-number" id="wcaDriftOut"></div></div>
        </div>
      </section>
    </div>

    <!-- Visualisatie onderaan -->
    <section class="card">
      <h2>3. Visualization</h2>
      <canvas id="compassCanvas" width="640" height="640"></canvas>
    </section>
  </div>

<script>
/* ======== helpers ======= */
function clamp(v, min, max) { return Math.min(max, Math.max(min, v)); }
function normDeg(d) { let r = d % 360; if (r < 0) r += 360; return r; }
function pad3(d){return Math.round(normDeg(d)).toString().padStart(3,'0');}
function formatVarDev(v){const a=Math.abs(v); if(!a)return "0°"; return (v>=0?"+":"−")+a+"° "+(v>=0?"E":"W");}
function formatRL(v){const a=Math.abs(v); if(!a)return "0°"; return (v>=0?"+":"−")+a+"°"+(v>=0?" R":" L");}

/* ====== DOM refs ====== */
const modeSelect=document.getElementById("modeSelect");
const tcRange=document.getElementById("tcRange"), tcInput=document.getElementById("tcInput");
const thRange=document.getElementById("thRange"), thInput=document.getElementById("thInput");
const ttRange=document.getElementById("ttRange"), ttInput=document.getElementById("ttInput");
const chRange=document.getElementById("chRange"), chInput=document.getElementById("chInput");
const variationRange=document.getElementById("variationRange"), variationInput=document.getElementById("variationInput");
const deviationRange=document.getElementById("deviationRange"), deviationInput=document.getElementById("deviationInput");
const wcaRange=document.getElementById("wcaRange"), wcaInput=document.getElementById("wcaInput");
const driftDisplay=document.getElementById("driftDisplay");

const tcOut=document.getElementById("tcOut"), mcOut=document.getElementById("mcOut"), ccOut=document.getElementById("ccOut");
const thOut=document.getElementById("thOut"), mhOut=document.getElementById("mhOut"), chOut=document.getElementById("chOut");
const ttOut=document.getElementById("ttOut"), mtOut=document.getElementById("mtOut"), ctOut=document.getElementById("ctOut");
const varOut=document.getElementById("varOut"), devOut=document.getElementById("devOut"), wcaDriftOut=document.getElementById("wcaDriftOut");

const canvas=document.getElementById("compassCanvas");
const ctx=canvas.getContext("2d");

/* ===== scroll sliders ===== */
function enableScrollSlider(slider){
  slider.addEventListener("wheel", e=>{
    e.preventDefault();
    const step = e.deltaY < 0 ? 1 : -1;
    slider.value = clamp(Number(slider.value)+step, slider.min, slider.max);
    slider.dispatchEvent(new Event("input"));
  });
}

[
  tcRange, thRange, ttRange, chRange,
  variationRange, deviationRange, wcaRange
].forEach(enableScrollSlider);

/* ===== sync helpers ===== */
function bind(rangeEl, numEl, min, max){
  rangeEl.addEventListener("input",()=>{
    numEl.value=rangeEl.value; recalc();
  });
  numEl.addEventListener("input",()=>{
    const v=clamp(Number(numEl.value||0),min,max);
    numEl.value=v; rangeEl.value=v; recalc();
  });
}

bind(tcRange,tcInput,0,359);
bind(thRange,thInput,0,359);
bind(ttRange,ttInput,0,359);
bind(chRange,chInput,0,359);
bind(variationRange,variationInput,-30,30);
bind(deviationRange,deviationInput,-10,10);
bind(wcaRange,wcaInput,-30,30);

modeSelect.addEventListener("change",recalc);

/* ===== hoofd berekening ===== */
function recalc(){
  const VAR=Number(variationRange.value);
  const DEV=Number(deviationRange.value);
  const WCA=Number(wcaRange.value);
  const DRIFT = -WCA;
  driftDisplay.value = DRIFT;

  let TC,TH,TT;

  if(modeSelect.value==="TC"){
    TC=normDeg(Number(tcRange.value));
    TT=TC;
    TH=normDeg(TT+WCA);
  }
  else if(modeSelect.value==="TH"){
    TH=normDeg(Number(thRange.value));
    TT=normDeg(TH-WCA);
    TC=TT;
  }
  else if(modeSelect.value==="TT"){
    TT=normDeg(Number(ttRange.value));
    TH=normDeg(TT+WCA);
    TC=TT;
  }
  else if(modeSelect.value==="CH"){
    const CHin=normDeg(Number(chRange.value));
    const MH=normDeg(CHin+DEV);
    TH=normDeg(MH+VAR);
    TT=normDeg(TH-WCA);
    TC=TT;
  }

  const MC=normDeg(TC-VAR);
  const MH=normDeg(TH-VAR);
  const MT=normDeg(TT-VAR);

  const CC=normDeg(MC-DEV);
  const CH=normDeg(MH-DEV);
  const CT=normDeg(MT-DEV);

  tcOut.textContent=pad3(TC)+"°";
  mcOut.textContent=pad3(MC)+"°";
  ccOut.textContent=pad3(CC)+"°";

  thOut.textContent=pad3(TH)+"°";
  mhOut.textContent=pad3(MH)+"°";
  chOut.textContent=pad3(CH)+"°";

  ttOut.textContent=pad3(TT)+"°";
  mtOut.textContent=pad3(MT)+"°";
  ctOut.textContent=pad3(CT)+"°";

  varOut.textContent=formatVarDev(VAR);
  devOut.textContent=formatVarDev(DEV);
  wcaDriftOut.textContent=`WCA ${formatRL(WCA)}, Drift ${formatRL(DRIFT)}`;

  drawCompass(TC,TH,TT,VAR,DEV);
}

/* ======= tekenen ====== */
function drawCompass(TC,TH,TT,VAR,DEV){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx=canvas.width/2, cy=canvas.height/2;
  const r=Math.min(cx,cy)*0.75;

  // achtergrond
  ctx.fillStyle="#ffffff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // cirkel
  ctx.strokeStyle="#d1d5db";
  ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();

  drawArrow(0,"T","#111827",3,r*1.05);
  drawArrow(VAR,"M","#ef4444",2,r*0.95);
  drawArrow(VAR+DEV,"C","#16a34a",2,r*0.85);

  drawLine(TC,"TC","#6b7280",2,r*0.95);
  drawLine(TH,"TH","#ffd000",2,r*0.85);
  drawArrow(TT,"TT","#2563eb",3,r*0.75);
}

function drawArrow(deg,label,color,width,len){
  const cx=canvas.width/2, cy=canvas.height/2;
  const a=(deg-90)*Math.PI/180;
  const x=cx+len*Math.cos(a), y=cy+len*Math.sin(a);

  ctx.strokeStyle=color; ctx.lineWidth=width;
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.stroke();

  // arrow head
  const head=12;
  const a1=a+150*Math.PI/180, a2=a-150*Math.PI/180;
  ctx.beginPath();
  ctx.moveTo(x,y); ctx.lineTo(x+head*Math.cos(a1),y+head*Math.sin(a1));
  ctx.moveTo(x,y); ctx.lineTo(x+head*Math.cos(a2),y+head*Math.sin(a2));
  ctx.stroke();

  // label
  ctx.fillStyle=color;
  ctx.font="12px system-ui";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(label, cx+(len+20)*Math.cos(a), cy+(len+20)*Math.sin(a));
}

function drawLine(deg,label,color,width,len){
  const cx=canvas.width/2, cy=canvas.height/2;
  const a=(deg-90)*Math.PI/180;
  const x=cx+len*Math.cos(a), y=cy+len*Math.sin(a);

  ctx.strokeStyle=color; ctx.lineWidth=width;
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.stroke();

  ctx.fillStyle=color;
  ctx.font="12px system-ui";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(label, cx+(len+15)*Math.cos(a), cy+(len+15)*Math.sin(a));
}

/* init */
recalc();

</script>
</body>
</html>
